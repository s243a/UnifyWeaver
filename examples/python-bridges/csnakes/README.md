# CSnakes + RPyC Example

Use CSnakes to embed CPython in .NET 8+ and access RPyC.

## Important: Source Generator Approach

CSnakes uses a **source generator** approach - it generates C# wrapper classes from Python files at compile time. This is different from Python.NET which allows dynamic Python execution.

For RPyC integration with CSnakes, you would:
1. Create a Python file with type-annotated wrapper functions
2. CSnakes generates C# methods at compile time
3. Call those generated methods from C#

## What is CSnakes?

CSnakes is a modern .NET 8+ library for embedding Python. It offers:
- Source generators for compile-time type safety
- First-class dependency injection support
- Better async support
- Modern .NET 8+ patterns

## Prerequisites

### .NET SDK 8.0+ (Required)

```bash
# Ubuntu/Debian
sudo apt install dotnet-sdk-8.0

# Or download from https://dotnet.microsoft.com/download
```

### CSnakes Templates

```bash
dotnet new install CSnakes.Templates
```

### Python Packages

```bash
pip install rpyc
```

## Creating an RPyC Integration

### Step 1: Create Python wrapper file

Create `rpyc_wrapper.py`:

```python
"""RPyC wrapper functions with type annotations for CSnakes."""

def connect_rpyc(host: str, port: int) -> bool:
    """Connect to RPyC server and run test."""
    import rpyc
    conn = rpyc.classic.connect(host, port)
    try:
        math = conn.modules.math
        result = math.sqrt(16)
        return result == 4.0
    finally:
        conn.close()

def get_numpy_mean(host: str, port: int) -> float:
    """Get numpy mean via RPyC."""
    import rpyc
    conn = rpyc.classic.connect(host, port)
    try:
        np = conn.modules.numpy
        arr = np.array([1, 2, 3, 4, 5])
        return float(np.mean(arr))
    finally:
        conn.close()
```

### Step 2: CSnakes generates C# wrapper

At compile time, CSnakes generates a class like:

```csharp
// Auto-generated by CSnakes
public class RpycWrapper {
    public bool ConnectRpyc(string host, int port) { ... }
    public double GetNumpyMean(string host, int port) { ... }
}
```

### Step 3: Use from C#

```csharp
var wrapper = env.RpycWrapper();
bool connected = wrapper.ConnectRpyc("localhost", 18812);
double mean = wrapper.GetNumpyMean("localhost", 18812);
```

## CSnakes vs Python.NET

| Feature | CSnakes | Python.NET |
|---------|---------|------------|
| .NET Version | 8.0+ only | 6.0+ |
| Execution | Compile-time generated | Runtime dynamic |
| Type Safety | Strong (source gen) | Dynamic |
| API Style | Generated wrappers | Direct Python calls |
| RPyC Pattern | Wrapper functions | Direct rpyc import |

**For RPyC specifically:**
- **Python.NET** is simpler - directly import and call rpyc
- **CSnakes** requires wrapper functions but provides type safety

## When to Choose CSnakes

Choose CSnakes when you:
- Want compile-time type safety
- Have well-defined Python functions to call
- Prefer generated wrappers over dynamic calls
- Are building a new .NET 8+ project

Choose Python.NET when you:
- Need dynamic Python execution
- Want to explore Python objects interactively
- Need .NET 6/7 compatibility
- Want direct access to rpyc APIs

## Architecture

```
┌────────────────────────────────────────────┐
│ .NET 8+ Process                            │
│ ┌────────────────────────────────────────┐ │
│ │ C# Application                         │ │
│ │   var wrapper = env.RpycWrapper();     │ │
│ │   wrapper.ConnectRpyc("localhost");    │ │
│ └────────────────────────────────────────┘ │
│               │                            │
│               ▼                            │
│ ┌────────────────────────────────────────┐ │
│ │ CSnakes Generated Wrapper              │ │
│ │   (calls rpyc_wrapper.py functions)    │ │
│ └────────────────────────────────────────┘ │
│               │                            │
│               ▼                            │
│ ┌────────────────────────────────────────┐ │
│ │ Embedded CPython                       │ │
│ │   rpyc_wrapper.connect_rpyc(...)       │ │
│ └────────────────────────────────────────┘ │
└────────────────────────────────────────────┘
                │
                │ TCP/IP
                ▼
┌────────────────────────────────────────────┐
│ RPyC Server (Python)                       │
│   - NumPy, SciPy, pandas                   │
│   - Custom services                        │
└────────────────────────────────────────────┘
```

## Status

This example demonstrates the CSnakes pattern for RPyC integration.
For a simpler, tested approach, see the Python.NET example which
allows direct RPyC usage without wrapper functions.
