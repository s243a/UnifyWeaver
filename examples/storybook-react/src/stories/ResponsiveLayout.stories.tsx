import type { Meta, StoryObj } from "@storybook/react";
import React from "react";
import {
  ResponsiveLayout,
  ResponsiveCard,
  BreakpointIndicator,
  ContainerQueryDemo,
} from "../components/ResponsiveLayout";
import { ThemeProvider } from "../components/ThemeToggle";

const meta: Meta<typeof ResponsiveLayout> = {
  title: "Layout/Responsive",
  component: ResponsiveLayout,
  tags: ["autodocs"],
  decorators: [
    (Story) => (
      <ThemeProvider>
        <div style={{ padding: "1rem" }}>
          <Story />
        </div>
      </ThemeProvider>
    ),
  ],
  parameters: {
    docs: {
      description: {
        component: `
Responsive layout components generated by UnifyWeaver for adaptive UIs.

**Generated from:** \`generate_responsive_layout/2\` in \`layout_generator.pl\`

\`\`\`prolog
% Define responsive breakpoints
?- declare_layout(my_layout, grid, [
    responsive([
      breakpoint(mobile, [columns(1), gap("0.5rem")]),
      breakpoint(tablet, [columns(2), gap("1rem")]),
      breakpoint(desktop, [columns(4), gap("1.5rem")])
    ])
  ]).

% Generate responsive CSS
?- generate_responsive_css(my_layout, CSS).
\`\`\`

### Breakpoint System

| Breakpoint | Max Width | Typical Use |
|------------|-----------|-------------|
| mobile | 640px | Single column, stacked layout |
| tablet | 1024px | 2 columns, condensed spacing |
| desktop | âˆž | Full multi-column layout |
        `,
      },
    },
    viewport: {
      viewports: {
        mobile: { name: "Mobile", styles: { width: "375px", height: "667px" } },
        tablet: { name: "Tablet", styles: { width: "768px", height: "1024px" } },
        desktop: { name: "Desktop", styles: { width: "1280px", height: "800px" } },
      },
    },
  },
};

export default meta;
type Story = StoryObj<typeof ResponsiveLayout>;

export const Default: Story = {
  render: () => (
    <div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}>
      <BreakpointIndicator />
      <ResponsiveLayout>
        <ResponsiveCard title="Revenue" value="$124,500" trend={12.5} />
        <ResponsiveCard title="Users" value="2,847" trend={8.3} />
        <ResponsiveCard title="Orders" value="1,234" trend={-2.1} />
        <ResponsiveCard title="Conversion" value="3.24%" trend={0.8} />
      </ResponsiveLayout>
    </div>
  ),
  parameters: {
    docs: {
      description: {
        story: "Resize the viewport or use the viewport toolbar to see the layout adapt.",
      },
    },
  },
};

export const TwoColumnLayout: Story = {
  render: () => (
    <ResponsiveLayout columns={{ mobile: 1, tablet: 2, desktop: 2 }}>
      <ResponsiveCard title="Left Panel" value="Content A" />
      <ResponsiveCard title="Right Panel" value="Content B" />
    </ResponsiveLayout>
  ),
  parameters: {
    docs: {
      description: {
        story: "A simple two-column layout that collapses to one column on mobile.",
      },
    },
  },
};

export const DenseGrid: Story = {
  render: () => (
    <ResponsiveLayout
      columns={{ mobile: 2, tablet: 3, desktop: 6 }}
      gap="0.5rem"
    >
      {Array.from({ length: 12 }, (_, i) => (
        <ResponsiveCard
          key={i}
          title={`Metric ${i + 1}`}
          value={Math.floor(Math.random() * 100)}
          trend={Math.random() > 0.5 ? Math.random() * 20 : -Math.random() * 10}
        />
      ))}
    </ResponsiveLayout>
  ),
  parameters: {
    docs: {
      description: {
        story: "Dense grid with 12 cards that adapts column count based on viewport.",
      },
    },
  },
};

export const BreakpointIndicatorStory: Story = {
  name: "Breakpoint Indicator",
  render: () => (
    <div
      style={{
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        gap: "2rem",
        padding: "2rem",
      }}
    >
      <BreakpointIndicator />
      <p style={{ color: "var(--color-text-secondary)", textAlign: "center" }}>
        Resize the browser window to see the breakpoint indicator change.
      </p>
    </div>
  ),
  parameters: {
    docs: {
      description: {
        story: "Shows the current responsive breakpoint based on viewport width.",
      },
    },
  },
};

export const ContainerQueries: Story = {
  render: () => (
    <div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}>
      <p style={{ color: "var(--color-text-secondary)", fontSize: "0.875rem" }}>
        Container queries allow components to adapt based on their container size,
        not the viewport. This enables truly reusable responsive components.
      </p>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "1fr 1fr",
          gap: "1rem",
        }}
      >
        <div>
          <h4 style={{ margin: "0 0 0.5rem 0", color: "var(--color-text-primary)" }}>
            Wide Container
          </h4>
          <div style={{ width: "100%" }}>
            <ContainerQueryDemo />
          </div>
        </div>
        <div>
          <h4 style={{ margin: "0 0 0.5rem 0", color: "var(--color-text-primary)" }}>
            Narrow Container
          </h4>
          <div style={{ width: "250px" }}>
            <ContainerQueryDemo />
          </div>
        </div>
      </div>
    </div>
  ),
  parameters: {
    docs: {
      description: {
        story: `
Container queries enable component-level responsiveness independent of viewport size.

\`\`\`prolog
% Generate container query CSS
?- declare_container_query(card, [
    query(min_width(400), [layout(horizontal)]),
    query(max_width(399), [layout(vertical)])
  ]).
\`\`\`
        `,
      },
    },
  },
};

export const MixedLayout: Story = {
  render: () => (
    <div style={{ display: "flex", flexDirection: "column", gap: "1.5rem" }}>
      <BreakpointIndicator />

      <section>
        <h3 style={{ margin: "0 0 0.5rem 0", color: "var(--color-text-primary)" }}>
          Header Stats
        </h3>
        <ResponsiveLayout columns={{ mobile: 2, tablet: 4, desktop: 4 }} gap="0.75rem">
          <ResponsiveCard title="Visitors" value="12.4K" trend={5.2} />
          <ResponsiveCard title="Page Views" value="48.2K" trend={12.8} />
          <ResponsiveCard title="Bounce" value="32%" trend={-3.1} />
          <ResponsiveCard title="Duration" value="4:32" trend={8.5} />
        </ResponsiveLayout>
      </section>

      <section style={{ display: "grid", gridTemplateColumns: "2fr 1fr", gap: "1rem" }}>
        <div>
          <h3 style={{ margin: "0 0 0.5rem 0", color: "var(--color-text-primary)" }}>
            Main Content
          </h3>
          <div
            style={{
              padding: "2rem",
              background: "var(--color-surface)",
              borderRadius: "var(--border-radius-lg)",
              border: "1px solid var(--color-border)",
              minHeight: "200px",
            }}
          >
            <p style={{ color: "var(--color-text-secondary)" }}>
              Main content area with charts and data visualizations.
            </p>
          </div>
        </div>
        <div>
          <h3 style={{ margin: "0 0 0.5rem 0", color: "var(--color-text-primary)" }}>
            Sidebar
          </h3>
          <ResponsiveLayout columns={{ mobile: 1, tablet: 1, desktop: 1 }} gap="0.5rem">
            <ResponsiveCard title="Active Users" value="847" />
            <ResponsiveCard title="Open Issues" value="23" />
            <ResponsiveCard title="Pending" value="12" />
          </ResponsiveLayout>
        </div>
      </section>
    </div>
  ),
  parameters: {
    docs: {
      description: {
        story: "Complete page layout mixing different responsive patterns.",
      },
    },
  },
};
