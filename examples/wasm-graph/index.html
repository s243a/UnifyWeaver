<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WASM Graph Visualization - UnifyWeaver</title>
  <!-- Generated by UnifyWeaver graph_module.pl -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #e0e0e0;
      min-height: 100vh;
    }
    header {
      padding: 1.5rem 2rem;
      background: rgba(255,255,255,0.05);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    h1 {
      font-size: 1.5rem;
      font-weight: 600;
      background: linear-gradient(135deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle { color: #888; font-size: 0.9rem; margin-top: 0.25rem; }
    main {
      display: grid;
      grid-template-columns: 320px 1fr;
      height: calc(100vh - 80px);
    }
    .sidebar {
      padding: 1.5rem;
      background: rgba(0,0,0,0.2);
      border-right: 1px solid rgba(255,255,255,0.1);
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #888;
      margin-bottom: 1rem;
    }
    .controls { display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem; }
    .input-group { display: flex; gap: 0.5rem; }
    input, select {
      flex: 1;
      padding: 0.5rem 0.75rem;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 0.9rem;
    }
    input::placeholder { color: #666; }
    button {
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, #00d4ff, #7c3aed);
      border: none;
      border-radius: 6px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s, opacity 0.2s;
    }
    button:hover { opacity: 0.9; transform: translateY(-1px); }
    button:active { transform: translateY(0); }
    button.secondary { background: rgba(255,255,255,0.1); }
    button.danger { background: linear-gradient(135deg, #ff6b6b, #ee5a5a); }
    .node-list, .edge-list { margin-top: 1rem; }
    .item {
      padding: 0.5rem 0.75rem;
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item .name { color: #00d4ff; font-weight: 500; }
    .item .relation { font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem; color: #aaa; }
    .item button { padding: 0.25rem 0.5rem; font-size: 0.75rem; }
    #graph { width: 100%; height: 100%; }
    .status {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      padding: 0.5rem 1rem;
      background: rgba(0,0,0,0.7);
      border-radius: 6px;
      font-size: 0.85rem;
    }
    .status.loading { color: #ffd700; }
    .status.ready { color: #00ff00; }
    .info-panel {
      padding: 1rem;
      background: rgba(0,0,0,0.3);
      border-radius: 6px;
      margin-top: 1rem;
    }
    .info-panel h3 { font-size: 0.9rem; margin-bottom: 0.5rem; color: #00d4ff; }
    .info-panel p { font-size: 0.85rem; color: #aaa; }
    .layout-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .layout-buttons button { flex: 1; min-width: 80px; }
  </style>
</head>
<body>
  <header>
    <h1>Family Tree</h1>
    <div class="subtitle">Biblical family relationships</div>
  </header>
  <main>
    <div class="sidebar">
      <h2>Layout</h2>
      <div class="layout-buttons">
        <button onclick="setLayout('cose')">Force</button>
        <button onclick="setLayout('circle')">Circle</button>
        <button onclick="setLayout('grid')">Grid</button>
        <button onclick="setLayout('breadthfirst')">Tree</button>
      </div>

      <h2 style="margin-top: 1.5rem">Add Edge</h2>
      <div class="controls">
        <div class="input-group">
          <input type="text" id="fromNode" placeholder="From node">
          <input type="text" id="toNode" placeholder="To node">
        </div>
        <button onclick="addEdge()">Add Edge</button>
      </div>

      <div class="controls">
        <button class="secondary" onclick="loadSampleData()">Load Sample Data</button>
        <button class="secondary" onclick="fitGraph()">Fit to View</button>
        <button class="danger" onclick="clearGraph()">Clear All</button>
      </div>

      <div id="selectedInfo" class="info-panel" style="display: none;">
        <h3>Selected Node</h3>
        <p id="selectedNodeInfo"></p>
      </div>

      <div class="edge-list">
        <h2>Edges (<span id="edgeCount">0</span>)</h2>
        <div id="edges"></div>
      </div>
    </div>
    <div id="graph"></div>
  </main>
  <div id="status" class="status loading">Initializing...</div>
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script type="module">
    // Graph Visualization - Generated by UnifyWeaver
    let cy;
    const nodeColor = '#7c3aed';
    const edgeColor = '#00d4ff';
    const selectedColor = '#ffd700';

    // Initial graph data from Prolog
    const initialData = [
      // Nodes
      { data: { id: "abraham", label: "Abraham" } },
      { data: { id: "sarah", label: "Sarah" } },
      { data: { id: "hagar", label: "Hagar" } },
      { data: { id: "ishmael", label: "Ishmael" } },
      { data: { id: "isaac", label: "Isaac" } },
      { data: { id: "rebekah", label: "Rebekah" } },
      { data: { id: "esau", label: "Esau" } },
      { data: { id: "jacob", label: "Jacob" } },
      // Edges
      { data: { id: "e0", source: "abraham", target: "ishmael" } },
      { data: { id: "e1", source: "hagar", target: "ishmael" } },
      { data: { id: "e2", source: "abraham", target: "isaac" } },
      { data: { id: "e3", source: "sarah", target: "isaac" } },
      { data: { id: "e4", source: "isaac", target: "esau" } },
      { data: { id: "e5", source: "isaac", target: "jacob" } },
      { data: { id: "e6", source: "rebekah", target: "esau" } },
      { data: { id: "e7", source: "rebekah", target: "jacob" } }
    ];

    function init() {
      cy = cytoscape({
        container: document.getElementById('graph'),
        elements: initialData,
        style: [
          {
            selector: 'node',
            style: {
              'background-color': nodeColor,
              'label': 'data(label)',
              'color': '#fff',
              'text-valign': 'center',
              'text-halign': 'center',
              'font-size': '12px',
              'width': '50px',
              'height': '50px',
              'border-width': '2px',
              'border-color': nodeColor
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 2,
              'line-color': edgeColor,
              'target-arrow-color': edgeColor,
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier'
            }
          },
          {
            selector: 'node:selected',
            style: {
              'border-width': '4px',
              'border-color': selectedColor
            }
          }
        ],
        layout: { name: 'cose', animate: true }
      });

      cy.on('tap', 'node', function(evt) {
        const node = evt.target;
        document.getElementById('selectedInfo').style.display = 'block';
        document.getElementById('selectedNodeInfo').textContent =
          `ID: $${node.id()}, Label: $${node.data('label')}`;
      });

      cy.on('tap', function(evt) {
        if (evt.target === cy) {
          document.getElementById('selectedInfo').style.display = 'none';
        }
      });

      updateEdgeList();
      document.getElementById('status').textContent = 'Ready';
      document.getElementById('status').className = 'status ready';
    }

    window.setLayout = function(name) {
      cy.layout({ name, animate: true }).run();
    };

    window.addEdge = function() {
      const from = document.getElementById('fromNode').value.trim();
      const to = document.getElementById('toNode').value.trim();
      if (!from || !to) return;

      // Add nodes if they don't exist
      if (!cy.$(`#$${from}`).length) {
        cy.add({ data: { id: from, label: from } });
      }
      if (!cy.$(`#$${to}`).length) {
        cy.add({ data: { id: to, label: to } });
      }

      // Add edge
      const edgeId = `e_$${from}_$${to}`;
      if (!cy.$(`#$${edgeId}`).length) {
        cy.add({ data: { id: edgeId, source: from, target: to } });
      }

      cy.layout({ name: 'cose', animate: true }).run();
      updateEdgeList();

      document.getElementById('fromNode').value = '';
      document.getElementById('toNode').value = '';
    };

    window.loadSampleData = function() {
      cy.elements().remove();
      cy.add(initialData);
      cy.layout({ name: 'cose', animate: true }).run();
      updateEdgeList();
    };

    window.fitGraph = function() {
      cy.fit();
    };

    window.clearGraph = function() {
      cy.elements().remove();
      updateEdgeList();
      document.getElementById('selectedInfo').style.display = 'none';
    };

    window.removeEdge = function(edgeId) {
      cy.$(`#$${edgeId}`).remove();
      // Remove orphan nodes
      cy.nodes().forEach(node => {
        if (node.degree() === 0) node.remove();
      });
      updateEdgeList();
    };

    function updateEdgeList() {
      const edges = cy.edges();
      document.getElementById('edgeCount').textContent = edges.length;
      document.getElementById('edges').innerHTML = edges.map(e =>
        `<div class="item">
          <span class="relation"><span class="name">$${e.source().id()}</span> → <span class="name">$${e.target().id()}</span></span>
          <button class="danger" onclick="removeEdge('$${e.id()}')">×</button>
        </div>`
      ).join('');
    }

    init();
  </script>
</body>
</html>
